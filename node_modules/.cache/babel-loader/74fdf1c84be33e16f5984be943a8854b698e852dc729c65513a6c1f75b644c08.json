{"ast":null,"code":"import _regeneratorRuntime from\"/home/atharva/Documents/projects/dappazon/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/atharva/Documents/projects/dappazon/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/atharva/Documents/projects/dappazon/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{ethers}from'ethers';// Components\nimport Rating from'./Rating';import close from'../assets/close.svg';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Product=function Product(_ref){var item=_ref.item,provider=_ref.provider,account=_ref.account,dappazon=_ref.dappazon,togglePop=_ref.togglePop;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),order=_useState2[0],setOrder=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),hasBought=_useState4[0],setHasBought=_useState4[1];var fetchDetails=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var events,orders,order;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dappazon.queryFilter(\"Buy\");case 2:events=_context.sent;orders=events.filter(function(event){return event.args.buyer===account&&event.args.itemId.toString()===item.id.toString();});if(!(orders.length===0)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:_context.next=8;return dappazon.orders(account,orders[0].args.orderId);case 8:order=_context.sent;setOrder(order);case 10:case\"end\":return _context.stop();}}},_callee);}));return function fetchDetails(){return _ref2.apply(this,arguments);};}();var buyHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var signer,transaction;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return provider.getSigner();case 2:signer=_context2.sent;_context2.next=5;return dappazon.connect(signer).buy(item.id,{value:item.cost});case 5:transaction=_context2.sent;_context2.next=8;return transaction.wait();case 8:setHasBought(true);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function buyHandler(){return _ref3.apply(this,arguments);};}();useEffect(function(){fetchDetails();},[hasBought]);return/*#__PURE__*/_jsx(\"div\",{className:\"product\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"product__details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"product__image\",children:/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:\"Product\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"product__overview\",children:[/*#__PURE__*/_jsx(\"h1\",{children:item.name}),/*#__PURE__*/_jsx(Rating,{value:item.rating}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"p\",{children:item.address}),/*#__PURE__*/_jsxs(\"h2\",{children:[ethers.utils.formatUnits(item.cost.toString(),'ether'),\" ETH\"]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h2\",{children:\"Overview\"}),/*#__PURE__*/_jsxs(\"p\",{children:[item.description,\"Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima rem, iusto, consectetur inventore quod soluta quos qui assumenda aperiam, eveniet doloribus commodi error modi eaque! Iure repudiandae temporibus ex? Optio!\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"product__order\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[ethers.utils.formatUnits(item.cost.toString(),'ether'),\" ETH\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"FREE delivery \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:new Date(Date.now()+345600000).toLocaleDateString(undefined,{weekday:'long',month:'long',day:'numeric'})})]}),item.stock>0?/*#__PURE__*/_jsx(\"p\",{children:\"In Stock.\"}):/*#__PURE__*/_jsx(\"p\",{children:\"Out of Stock.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"product__buy\",onClick:buyHandler,children:\"Buy Now\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"small\",{children:\"Ships from\"}),\" Dappazon\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"small\",{children:\"Sold by\"}),\" Dappazon\"]}),order&&/*#__PURE__*/_jsxs(\"div\",{className:\"product__bought\",children:[\"Item bought on \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:new Date(Number(order.time.toString()+'000')).toLocaleDateString(undefined,{weekday:'long',hour:'numeric',minute:'numeric',second:'numeric'})})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:togglePop,className:\"product__close\",children:/*#__PURE__*/_jsx(\"img\",{src:close,alt:\"Close\"})})]})});};export default Product;","map":{"version":3,"names":["useEffect","useState","ethers","Rating","close","Product","item","provider","account","dappazon","togglePop","order","setOrder","hasBought","setHasBought","fetchDetails","queryFilter","events","orders","filter","event","args","buyer","itemId","toString","id","length","orderId","buyHandler","getSigner","signer","connect","buy","value","cost","transaction","wait","image","name","rating","address","utils","formatUnits","description","Date","now","toLocaleDateString","undefined","weekday","month","day","stock","Number","time","hour","minute","second"],"sources":["/home/atharva/Documents/projects/dappazon/src/components/Product.js"],"sourcesContent":["import { useEffect, useState } from 'react'\r\nimport { ethers } from 'ethers'\r\n\r\n// Components\r\nimport Rating from './Rating'\r\n\r\nimport close from '../assets/close.svg'\r\n\r\nconst Product = ({ item, provider, account, dappazon, togglePop }) => {\r\n  const [order, setOrder] = useState(null)\r\n  const [hasBought, setHasBought] = useState(false)\r\n\r\n  const fetchDetails = async () => {\r\n    const events = await dappazon.queryFilter(\"Buy\")\r\n    const orders = events.filter(\r\n      (event) => event.args.buyer === account && event.args.itemId.toString() === item.id.toString()\r\n    )\r\n\r\n    if (orders.length === 0) return\r\n\r\n    const order = await dappazon.orders(account, orders[0].args.orderId)\r\n    setOrder(order)\r\n  }\r\n\r\n  const buyHandler = async () => {\r\n    const signer = await provider.getSigner()\r\n\r\n    // Buy item...\r\n    let transaction = await dappazon.connect(signer).buy(item.id, { value: item.cost })\r\n    await transaction.wait()\r\n\r\n    setHasBought(true)\r\n  }\r\n\r\n  useEffect(() => {\r\n    fetchDetails()\r\n  }, [hasBought])\r\n\r\n  return (\r\n    <div className=\"product\">\r\n      <div className=\"product__details\">\r\n        <div className=\"product__image\">\r\n          <img src={item.image} alt=\"Product\" />\r\n        </div>\r\n        <div className=\"product__overview\">\r\n          <h1>{item.name}</h1>\r\n\r\n          <Rating value={item.rating} />\r\n\r\n          <hr />\r\n\r\n          <p>{item.address}</p>\r\n\r\n          <h2>{ethers.utils.formatUnits(item.cost.toString(), 'ether')} ETH</h2>\r\n\r\n          <hr />\r\n\r\n          <h2>Overview</h2>\r\n\r\n          <p>\r\n            {item.description}\r\n\r\n            Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima rem, iusto,\r\n            consectetur inventore quod soluta quos qui assumenda aperiam, eveniet doloribus\r\n            commodi error modi eaque! Iure repudiandae temporibus ex? Optio!\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"product__order\">\r\n          <h1>{ethers.utils.formatUnits(item.cost.toString(), 'ether')} ETH</h1>\r\n\r\n          <p>\r\n            FREE delivery <br />\r\n            <strong>\r\n              {new Date(Date.now() + 345600000).toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' })}\r\n            </strong>\r\n          </p>\r\n\r\n          {item.stock > 0 ? (\r\n            <p>In Stock.</p>\r\n          ) : (\r\n            <p>Out of Stock.</p>\r\n          )}\r\n\r\n          <button className='product__buy' onClick={buyHandler}>\r\n            Buy Now\r\n          </button>\r\n\r\n          <p><small>Ships from</small> Dappazon</p>\r\n          <p><small>Sold by</small> Dappazon</p>\r\n\r\n          {order && (\r\n            <div className='product__bought'>\r\n              Item bought on <br />\r\n              <strong>\r\n                {new Date(Number(order.time.toString() + '000')).toLocaleDateString(\r\n                  undefined,\r\n                  {\r\n                    weekday: 'long',\r\n                    hour: 'numeric',\r\n                    minute: 'numeric',\r\n                    second: 'numeric'\r\n                  })}\r\n              </strong>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n\r\n        <button onClick={togglePop} className=\"product__close\">\r\n          <img src={close} alt=\"Close\" />\r\n        </button>\r\n      </div>\r\n    </div >\r\n  );\r\n}\r\n\r\nexport default Product;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}